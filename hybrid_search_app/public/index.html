<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Neon Search</title>
<style>
  body { 
    background: linear-gradient(135deg, #000, #1a1a2e); 
    color: #0ff; 
    font-family: 'Consolas', 'Monaco', monospace; 
    margin:0; 
    padding:2rem; 
  }
  h1 { 
    font-size:2.5rem; 
    text-align:center; 
    margin-bottom:1rem; 
    text-shadow:0 0 20px #0ff,0 0 40px #0ff; 
  }
  .search-box { 
    background:#222; 
    padding:1rem; 
    border-radius:8px; 
    margin-bottom:1rem; 
    display:flex; 
    flex-wrap:wrap; 
    gap:0.75rem; 
    align-items:center; 
  }
  input, select, button { 
    font-family:Consolas, Monaco, monospace; 
    padding:0.6rem 1.2rem; 
    border:2px solid #0ff; 
    border-radius:4px; 
    font-size:1rem; 
    background: #111; 
    color: #0ff; 
    /* Neon Text for inputs/selects */
    text-shadow: 0 0 5px #0ff; 
  }
  input::placeholder { color: #555; }
  
  /* Upgraded Neon Button Style */
  button { 
    background:linear-gradient(135deg, #0ff, #f0f); 
    color: #000; /* Black text for better contrast on neon gradient */
    cursor:pointer; 
    font-weight:bold; 
    border-color: #f0f; 
    transition: all 0.3s ease; 
    box-shadow: 0 0 10px #f0f; /* Subtle glow */
  }
  button:hover { 
    filter: brightness(1.2); 
    transform: translateY(-2px); 
    box-shadow: 0 0 20px #f0f, 0 0 30px #0ff; /* Stronger neon glow on hover */
  }

  #results { 
    display:grid; 
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); 
    gap:1rem; 
    margin-top:1rem; 
  }
  .card { 
    background:#222; 
    border:2px solid #0ff; 
    border-radius:8px; 
    overflow:hidden; 
    cursor:pointer; 
    transition:transform 0.2s ease, box-shadow 0.3s ease; 
  }
  .card:hover { 
    transform:scale(1.03); 
    box-shadow: 0 0 15px #0ff, 0 0 25px rgba(0, 255, 255, 0.5); /* Enhanced card neon glow */
  }
  .card img { 
    width:100%; 
    height:160px; 
    object-fit:cover; 
    border-bottom: 2px solid #0ff; 
  }
  .card .title { 
    padding: 0.75rem; 
    font-size:0.9rem; 
    font-weight:bold; 
    word-wrap: break-word; 
  }
  .footer { 
    text-align:center; 
    font-size:0.9rem; 
    margin-top:2rem; 
    color:#555; 
  }
  .loading, .error { 
    text-align:center; 
    padding: 2rem; 
    font-size: 1.2rem; 
  }
</style>
</head>
<body>
<h1>üî• NEON SEARCH üî•</h1>
<div class="search-box">
<input id="search" type="text" placeholder="Search term..." aria-label="Search term"/>
<select id="driver" aria-label="Select driver">
  <option value="pornhub">Pornhub</option>
  <option value="xnxx">XNXX</option>
  <option value="xvideos">Xvideos</option>
  <option value="xhamster">Xhamster</option>
  <option value="youporn">Youporn</option>
  <option value="sex">Sex.com</option>
  <option value="redtube">Redtube</option>
  <option value="eporner">Eporner</option>
  <option value="wowxxx">Wow XXX</option>
  <option value="mock">Mock</option>
</select>
<select id="type" aria-label="Select content type">
  <option value="videos">Videos</option>
  <option value="gifs">GIFs</option>
</select>
<input id="page" type="number" min="1" value="1" placeholder="Page" aria-label="Page number" style="width:80px"/>
<button onclick="doSearch()" aria-label="Perform search">Search</button>
</div>
<div id="stats" class="loading"></div>
<div id="results"></div>
<div class="footer">‚ö†Ô∏è Adult Content. Use Responsibly.</div>

<script>
  const searchInput = document.getElementById('search');
  const driverSelect = document.getElementById('driver');
  const typeSelect = document.getElementById('type');
  const pageInput = document.getElementById('page');
  const resultsDiv = document.getElementById('results');
  const statsDiv = document.getElementById('stats');

  async function doSearch() {
    const query = searchInput.value.trim();
    const driver = driverSelect.value;
    const type = typeSelect.value;
    const page = pageInput.value || 1;

    if (!query) {
      resultsDiv.innerHTML = '<p class="error">Please enter a search term.</p>';
      return;
    }

    resultsDiv.innerHTML = '<p class="loading">Loading...</p>';
    statsDiv.innerHTML = '';

    try {
      const startTime = performance.now();
      // Ensure page is an integer and greater than 0
      const pageNum = Math.max(1, parseInt(page)); 
      
      const url = `/api/search?query=${encodeURIComponent(query)}&driver=${driver}&type=${type}&page=${pageNum}`;
      const res = await fetch(url);
      const data = await res.json();
      const endTime = performance.now();
      const duration = ((endTime - startTime) / 1000).toFixed(2);

      if (!res.ok) {
        throw new Error(data.error || `HTTP error! status: ${res.status}`);
      }

      statsDiv.innerHTML = `Found ${data.length} items from ${driver} (${type}) in ${duration}s`;

      if (data.length === 0) {
        resultsDiv.innerHTML = '<p class="loading">No results found for your query.</p>';
        return;
      }

      resultsDiv.innerHTML = data.map(d => `
        <div class="card" onclick="window.open('${d.url}', '_blank')" title="${d.title}">
          <img src="${d.thumbnail}" alt="${d.title || 'Video Thumbnail'}" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/220x160/000000/00FFFF?text=NO+IMAGE+FOUND';" />
          <div class="title">${d.title}</div>
        </div>
      `).join('');

    } catch(e) {
      console.error("Search error:", e);
      resultsDiv.innerHTML = `<p class="error">Error: ${e.message}</p>`;
      statsDiv.innerHTML = 'Search failed.';
    }
  }

  // Allow searching by pressing Enter in the input field
  searchInput.addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault(); 
      doSearch();
    }
  });

  // Initial setup: fetch available drivers if needed (optional)
  fetch('/api/health')
    .then(res => res.json())
    .then(data => {
      const driverSelect = document.getElementById('driver');
      
      // Get all current option values to prevent duplicates
      const currentOptions = new Set([...driverSelect.options].map(opt => opt.value.toLowerCase()));

      // Add new options from the API health check
      data.drivers.forEach(driverName => {
        if (!currentOptions.has(driverName.toLowerCase())) {
            const option = document.createElement('option');
            option.value = driverName;
            // Capitalize for display, keeping value lowercased for consistency
            option.textContent = driverName.charAt(0).toUpperCase() + driverName.slice(1); 
            driverSelect.appendChild(option);
            currentOptions.add(driverName.toLowerCase()); // Add to set
        }
      });
    })
    .catch(err => console.error('Failed to fetch driver list:', err));

</script>
</body>
</html>
